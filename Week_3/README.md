# INDEX
* [Week 3](#Week-3)
  * [Xschem: Pre-layout simulation for Ring Oscillator](#Xschem-Pre-layout-simulation-for-Ring-Oscillator)
  * [ALIGN: Post-layout simulation for Ring Oscillator](#ALIGN-Post-layout-simulation-for-Ring-Oscillator)
  
  
  
# Xschem: Pre-layout simulation for Ring Oscillator
A ring oscillator is an electronic circuit that generates a periodic waveform, typically a square wave or a sine wave, using a feedback loop of inverters or delay elements. It is a type of oscillator that does not require any external components like resistors, capacitors or crystals to generate a clock signal.

The basic principle behind the ring oscillator is that a chain of odd number of inverters are connected in a loop, and the output of the last inverter is fed back to the input of the first inverter. This creates a positive feedback loop that causes the circuit to oscillate at a frequency determined by the delay of each inverter.

Ring oscillators are widely used in digital circuits as clock generators, frequency dividers, and timing references. They are simple and easy to implement, making them popular in integrated circuits where small size and low power consumption are critical factors.

The following figure depicts a 3-stage ring oscillator in Xschem.

![Z1](https://user-images.githubusercontent.com/114692581/222699738-a392a4bc-d68e-4288-b982-a13d5ac4c54f.PNG)

3-stage ring oscillator shown as a symbol in following figure.

![Z2](https://user-images.githubusercontent.com/114692581/222699994-b1716570-6c32-4222-a64e-92b8e8e7aafc.PNG)

3-stage ring oscillator shown as a testbench schematic in following figure.

![Z3](https://user-images.githubusercontent.com/114692581/222700155-81a26743-07e0-41e8-a110-710d6dc82d21.PNG)

**Netlist of pre-layout testbench schematic :**
```
** sch_path: /home/swagatika/Desktop/Circuits/RingOscillator_tb.sch
**.subckt RingOscillator_tb out
*.opin out
x1 VDD out GND RingOscillator_sym
V1 VDD GND 1.8
.save i(v1)
**** begin user architecture code
.lib /home/swagatika/open_pdks/sky130/sky130A/libs.tech/ngspice/sky130.lib.spice tt
.save all

.tran 1p 5n
.control
run
plot out
.save all
.endc
.end

**** end user architecture code
**.ends

* expanding   symbol:  /home/swagatika/Desktop/Circuits/RingOscillator_sym.sym # of pins=3
** sym_path: /home/swagatika/Desktop/Circuits/RingOscillator_sym.sym
** sch_path: /home/swagatika/Desktop/Circuits/RingOscillator_sym.sch
.subckt RingOscillator_sym Vdd out Gnd
*.opin out
*.iopin Vdd
*.iopin Gnd
XM1 net1 out Vdd Vdd sky130_fd_pr__pfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM2 net2 net1 Vdd Vdd sky130_fd_pr__pfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM3 out net2 Vdd Vdd sky130_fd_pr__pfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM4 net1 out Gnd Gnd sky130_fd_pr__nfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM5 net2 net1 Gnd Gnd sky130_fd_pr__nfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM6 out net2 Gnd Gnd sky130_fd_pr__nfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
.ends

.GLOBAL GND
.GLOBAL VDD
.end
```
After successfully running for 5ns with 1ps steps, the generated NgSpice plot shown below.

![Z5](https://user-images.githubusercontent.com/114692581/222702918-e694787d-399f-407c-bb02-859e96cb7fba.PNG)

![z4](https://user-images.githubusercontent.com/114692581/222702602-7b4dbadf-99a3-45cd-84d6-5bbbc09e6f4a.PNG)

# ALIGN: Post-layout simulation for Ring Oscillator
A simple SPICE Netlist for ring oscillator is generated by modifying the pre-layout testbench netlist and saved in `.sp` format to generate `.lef` and `.gds` files.

Input netlist for ALIGN tool,
```
.subckt RingOscillator Vdd out Gnd

XM1 net1 out Vdd Vdd sky130_fd_pr__pfet_01v8 L=150n W=1050n nf=8
XM2 net2 net1 Vdd Vdd sky130_fd_pr__pfet_01v8 L=150n W=1050n nf=8
XM3 out net2 Vdd Vdd sky130_fd_pr__pfet_01v8 L=150n W=1050n nf=8
XM4 net1 out Gnd Gnd sky130_fd_pr__nfet_01v8 L=150n W=1050n nf=8
XM5 net2 net1 Gnd Gnd sky130_fd_pr__nfet_01v8 L=150n W=1050n nf=8
XM6 out net2 Gnd Gnd sky130_fd_pr__nfet_01v8 L=150n W=1050n nf=8
.ends RingOscillator
```
> **NOTE:** In input netlist of ALIGN tool, the parameter 'nf' that is, noise figure should be in even number. But, when the noise figure in input netlist of ring oscillator is setting  into 2 and 4, it is giving incorrect result. The models generated in the simulation may not accurately capture the behavior of the ring oscillator layout.

> When we are increasing the value of 'nf' that is, 6, 8, 10..., we got the accurate result same as pre-layout which is going to discuss in below sections.


Run the ALIGN tool using below commands.
```
$ python3 -m venv general
$ source general/bin/activate
```
Go to ALIGN-public directory,
```
$ cd work
$ schematic2layout.py ../ALIGN-pdk-sky130/examples/ringosci -p ../pdks/SKY130_PDK/
```
Successfully generated the `.gds`and `.lef` files.

![Z6](https://user-images.githubusercontent.com/114692581/222713798-5ace4ab6-22d8-4e94-a244-5b99b51b827c.PNG)

![Z7](https://user-images.githubusercontent.com/114692581/222713845-3e941886-d5dc-49bf-a50a-77757bb28058.PNG)


## Generated .lef and .gds files in KLayout
* **.gds**
  
  ![Z8](https://user-images.githubusercontent.com/114692581/222714535-03657c78-470c-4377-83f7-fc9228ebec5b.PNG)
  
* **.lef**
  
  ![Z9](https://user-images.githubusercontent.com/114692581/222714589-9970ec6b-ac4c-4fc8-b729-54c54dd2ebfd.PNG)









