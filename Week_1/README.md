# INDEX
* [Week 1](#Week-1)
  - [Inverter Post-layout characterization using ALIGN tool](#Inverter-Post-layout-characterization-using-ALIGN-tool)
    - [Generated .lef and .gds files in KLayout](#Generated-lef-and-gds-files-in-KLayout)
  - [Pre-layout simulation of a function using Xschem, NgSpice and sky130 PDKs](#Pre-layout-simulation-of-a-function-using-Xschem-NgSpice-and-sky130-PDKs)
    - [Make Symbol from Schematic and an independent testbench circuit to simulate](#Make-Symbol-from-Schematic-and-an-independent-testbench-circuit-to-simulate)
  - [Post-layout using given function Schematic in Magic VLSI tool and sky130 PDKs](#Post-layout-using-given-function-Schematic-in-Magic-VLSI-tool-and-sky130-PDKs)
    - [Comparison between Pre-layout and Post-layout testbench of function schematic :](#Comparison-between-Pre-layout-and-Post-layout-testbench-of-function-schematic)
  - [Post-layout characterization of given function using ALIGN tool](#Post-layout-characterization-of-given-function-using-ALIGN-tool)
    - [Generated .lef and .gds files of given function in KLayout](#Generated-lef-and-gds-files-of-given-function-in-KLayout)
    
# Week 1
The installation of ALIGN tool is discussed in ["Week_0"](https://github.com/Swagatika-Meher/msvsd2bitcomp/tree/main/Week_0) section.
# Inverter Post-layout characterization using ALIGN tool
Everytime start the ALIGN tool by running the following commands.
```
$ python3 -m venv general
$ source general/bin/activate
```
Then, go to ALIGN-public directory,
```
$ mkdir work
$ cd work
```
Running the inverter pre-layout spice netlist on Sky130pdk,
```
schematic2layout.py ../ALIGN-pdk-sky130/examples/Inverter -p ../pdks/SKY130_PDK/
```
A simple SPICE Netlist for inverter is written in `.sp` format to generate .lef and .gds files,
```
.subckt Inverter vdd OUT IN gnd

XPMOS OUT IN vdd vdd sky130_fd_pr__pfet_01v8 L=150n W=1050n nf=2
XNMOS OUT IN gnd gnd sky130_fd_pr__nfet_01v8 L=150n W=1050n nf=2
.ends Inverter
```

![AL1](https://user-images.githubusercontent.com/114692581/220003250-a22ae0f0-72db-4fc7-9a3f-7d8c7476eb97.PNG)

![AL2](https://user-images.githubusercontent.com/114692581/220003271-e09c7570-7918-4acf-89bf-b6bb9c6330ab.PNG)

## Generated .lef and .gds files in KLayout
* **.gds**
  
  ![AL3](https://user-images.githubusercontent.com/114692581/220005343-14d89aa9-326f-4172-8da9-b43b92993445.PNG)
  
* **.lef**
  
  ![AL4](https://user-images.githubusercontent.com/114692581/220005370-9aad1091-c8ab-46bd-8645-9389c645ecf5.PNG)
  

To extract the spice netlist of above post-layout go to MAGIC tool and read the .gds file.
Open magic tool and `go to file --> read GDS --> open the .gds file` and view the layout in magic tool.

![AL5](https://user-images.githubusercontent.com/114692581/220414388-c008c9e9-06d1-4e45-b489-1699e754bffb.PNG)

Now, click `i` and go to `Tkcon.tcl` command window. Type the following command to extract the netlist.
```
extract do local
extract all
ext2spice cthresh 0 rthresh 0
ext2spice
```
* Align post layout .spice file is created in work directory,
```
* SPICE3 file created from INVERTER_0.ext - technology: sky130A

X0 OUT IN GND GND sky130_fd_pr__nfet_01v8 ad=2.94e+11p pd=2.66e+06u as=5.565e+11p ps=5.26e+06u w=1.05e+06u l=150000u
X1 GND IN OUT GND sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=1.05e+06u l=150000u
X2 OUT IN INV_33483112_0_0_1676996573_0/PMOS_S_3683112_X1_Y1_1676996573_1676996573_0/w_0_0# INV_33483112_0_0_1676996573_0/PMOS_S_3683112_X1_Y1_1676996573_1676996573_0/w_0_0# sky130_fd_pr__pfet_01v8 ad=2.94e+11p pd=2.66e+06u as=5.565e+11p ps=5.26e+06u w=1.05e+06u l=150000u
X3 INV_33483112_0_0_1676996573_0/PMOS_S_3683112_X1_Y1_1676996573_1676996573_0/w_0_0# IN OUT INV_33483112_0_0_1676996573_0/PMOS_S_3683112_X1_Y1_1676996573_1676996573_0/w_0_0# sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=1.05e+06u l=150000u
C0 IN INV_33483112_0_0_1676996573_0/PMOS_S_3683112_X1_Y1_1676996573_1676996573_0/w_0_0# 1.10fF
C1 OUT INV_33483112_0_0_1676996573_0/PMOS_S_3683112_X1_Y1_1676996573_1676996573_0/w_0_0# 0.79fF
C2 IN OUT 0.31fF
C3 OUT GND 0.69fF **FLOATING
C4 IN GND 1.45fF **FLOATING
C5 INV_33483112_0_0_1676996573_0/PMOS_S_3683112_X1_Y1_1676996573_1676996573_0/w_0_0# GND 3.02fF **FLOATING
```
After exporting '.gds' file generated by Align to magic and extract '.spice' file, manually the node 'VDD' in generated netlist by magic is renamed and the postlayout (generated by ALIGN tool) compared with pre-layout testbench inverter schematic.
```
* SPICE3 file created from INVERTER_0.ext - technology: sky130A

.subckt INVERTER_0 VDD OUT IN GND
X0 OUT IN GND GND sky130_fd_pr__nfet_01v8 ad=2.94e+11p pd=2.66e+06u as=5.565e+11p ps=5.26e+06u w=1.05e+06u l=150000u
X1 GND IN OUT GND sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=1.05e+06u l=150000u
X2 OUT IN VDD VDD sky130_fd_pr__pfet_01v8 ad=2.94e+11p pd=2.66e+06u as=5.565e+11p ps=5.26e+06u w=1.05e+06u l=150000u
X3 VDD IN OUT VDD sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=1.05e+06u l=150000u
C0 IN VDD 1.10fF
C1 OUT VDD 0.79fF
C2 IN OUT 0.31fF
.ends

V1 Vin GND pulse(0 1.8 0ns 1ns 1ns 5ns 10ns)
.save i(v1)
VDD VDD GND 1.8
.save i(vdd)
x1 VDD Vout Vin GND INVERTER_0
**** begin user architecture code
.lib /home/swagatika/open_pdks/sky130/sky130A/libs.tech/ngspice/sky130.lib.spice tt

.save all
.tran 1n 30n
.control
run
set color0=white
set color1=black
plot Vin Vout
set xbrushwidth=3
.save all
.endc
.end
```
* **NgSpice plot**
  
  ![AL23](https://user-images.githubusercontent.com/114692581/220418424-16c7935c-75ed-41ee-8cc9-69f4867024e9.PNG)
  
  ![AL24](https://user-images.githubusercontent.com/114692581/220418679-76d778fc-095a-4396-b917-23e565247dc7.PNG)

# Pre-layout simulation of a function using Xschem, NgSpice and sky130 PDKs
Given, $\{F_n} = \overline {\left( {B + D} \right) \cdot \left( {A + C} \right) + E \cdot F} \$

An initial schematic of given function is made by placing components from the open_pdk library in Xschem simulator.

![01](https://user-images.githubusercontent.com/114692581/221765550-0d743d1a-e7fd-452a-8fe2-eef53f142608.PNG)

* **NgSpice Plot**

  ![02](https://user-images.githubusercontent.com/114692581/221765604-9317e0fa-d18d-4659-b67b-528312627150.PNG)
  
## Make Symbol from Schematic and an independent testbench circuit to simulate
The following is schematic of function with metal pins.

![AL8](https://user-images.githubusercontent.com/114692581/219733791-81de381c-997e-4f53-8859-4c8ec51ec44c.PNG)

Then, go to Symbol and click on make symbol from schematic. To create a layout of this circuit but first, we need to functionally validate it and for that we need to create an independent testbench with the schematic as a symbol.

![03](https://user-images.githubusercontent.com/114692581/221765681-ac9f3ea5-efd2-41d5-914b-32c808a427c6.PNG)

* **Netlist of pre-layout testbench schematic :**
```
** sch_path: /home/swagatika/Desktop/Circuits/function_pre_tb.sch
**.subckt function_pre_tb A B C D E F E F C D B A VDD VDD Fn
*.ipin A
*.ipin B
*.ipin C
*.ipin D
*.ipin E
*.ipin F
*.ipin E
*.ipin F
*.ipin C
*.ipin D
*.ipin B
*.ipin A
*.iopin VDD
*.iopin VDD
*.opin Fn
V1 A GND pulse(0 1.8 0.1n 10p 10p 1n 2n)
.save i(v1)
V2 B GND pulse(0 1.8 0.2n 10p 10p 1n 2n)
.save i(v2)
V3 C GND pulse(0 1.8 0.3n 10p 10p 1n 2n)
.save i(v3)
V4 D GND pulse(0 1.8 0.4n 10p 10p 1n 2n)
.save i(v4)
V5 E GND pulse(0 1.8 0.5n 10p 10p 1n 2n)
.save i(v5)
V6 F GND pulse(0 1.8 0.6n 10p 10p 1n 2n)
.save i(v6)
V7 VDD GND 1.8
.save i(v7)
x1 VDD A B D C F E Fn GND function_pre_sym
**** begin user architecture code

.tran 10p 4n
.control
run
plot A+3 B+3 C+3 D+3 E+3 F+3 Fn
.save all
.endc
.end

.lib /home/swagatika/open_pdks/sky130/sky130A/libs.tech/ngspice/sky130.lib.spice tt

.save all

**** end user architecture code
**.ends

* expanding   symbol:  /home/swagatika/Desktop/Circuits/function_pre_sym.sym # of pins=9
** sym_path: /home/swagatika/Desktop/Circuits/function_pre_sym.sym
** sch_path: /home/swagatika/Desktop/Circuits/function_pre_sym.sch
.subckt function_pre_sym VDD A B D C F E Fn Gnd
*.ipin A
*.ipin B
*.ipin C
*.ipin D
*.ipin E
*.ipin F
*.opin Fn
*.iopin VDD
*.iopin Gnd
XM1 net3 A VDD VDD sky130_fd_pr__pfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM2 net1 B VDD VDD sky130_fd_pr__pfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM3 net2 C net3 net3 sky130_fd_pr__pfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM4 net2 D net1 net1 sky130_fd_pr__pfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM5 Fn E net2 net2 sky130_fd_pr__pfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM6 Fn F net2 net2 sky130_fd_pr__pfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM7 Fn A net4 net4 sky130_fd_pr__nfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM8 Fn C net4 net4 sky130_fd_pr__nfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM9 Fn E net5 net5 sky130_fd_pr__nfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM10 net4 B Gnd Gnd sky130_fd_pr__nfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM11 net4 D Gnd Gnd sky130_fd_pr__nfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
XM12 net5 F Gnd Gnd sky130_fd_pr__nfet_01v8 L=0.15 W=1 nf=1 ad='int((nf+1)/2) * W/nf * 0.29' as='int((nf+2)/2) * W/nf * 0.29'
+ pd='2*int((nf+1)/2) * (W/nf + 0.29)' ps='2*int((nf+2)/2) * (W/nf + 0.29)' nrd='0.29 / W' nrs='0.29 / W'
+ sa=0 sb=0 sd=0 mult=1 m=1
.ends

.GLOBAL GND
.end
```
* **NgSpice Plot :**

![05](https://user-images.githubusercontent.com/114692581/221766071-e0ebd28a-9689-4ed6-ad1e-6d42a5d1eb95.PNG)

![04](https://user-images.githubusercontent.com/114692581/221766109-f5f7cab7-7016-4d67-9357-77ae40cb6134.PNG)

# Post-layout using given function Schematic in Magic VLSI tool and sky130 PDKs
Open Magic VLSI tool using below command.
```
$ magic -d XR
```
OR
```
$ magic -T sky130A.tech
```
Once import the `.spice` file, an empty inverter cell will be visible with black bounding box. Move cursor over the cell and press `s`. Then press `x`. Save the `.mag` files in the same working directory. Navigate to `.mag` file using the terminal and rename the files to match the missing cell name displayed on the `tkcon` window. Reload the renamed `.mag` file in magic layout and expand the cell. NFET, PFET and the metal contacts will be visible. Place the cells and route the metal1 and metal2 layer such that the layout should be DRC free as shown below.

![AL12](https://user-images.githubusercontent.com/114692581/219744268-2553f31d-b60c-4594-86cf-3a7dc4068a52.PNG)

The above layout is designed using Euler's path. For the given function, the Euler's path is `A-C-E-F-D-B`. Here, the inputs are conneted in this manner. Vdd is given to A & B inputs of PMOS, while GND is given to B, D, F inputs of NMOS transistors. 
Now, `go to File --> save and select autowrite`. Then, go to the Tkcon.tcl command window and type the following.
```
extract do local
extract all
ext2spice lvs
ext2spice cthresh 0 rthresh 0
ext2spice
```
Now, we can close magic.

The generated post-layout function netlist extracts the interconnect parasitics, that were absent in pre-layout netlist.
```
* NGSPICE file created from function_post.ext - technology: sky130A

.subckt sky130_fd_pr__nfet_01v8_648S5X a_n73_n100# a_n33_n188# a_15_n100# a_n175_n274#
X0 a_15_n100# a_n33_n188# a_n73_n100# a_n175_n274# sky130_fd_pr__nfet_01v8 ad=2.9e+11p pd=2.58e+06u as=2.9e+11p ps=2.58e+06u w=1e+06u l=150000u
C0 a_n73_n100# a_n33_n188# 0.03fF
C1 a_15_n100# a_n73_n100# 0.16fF
C2 a_15_n100# a_n33_n188# 0.03fF
C3 a_15_n100# a_n175_n274# 0.08fF
C4 a_n73_n100# a_n175_n274# 0.11fF
C5 a_n33_n188# a_n175_n274# 0.30fF
.ends

.subckt sky130_fd_pr__pfet_01v8_XGS3BL a_n73_n100# a_15_n100# w_n211_n319# a_n33_n197#
+ VSUBS
X0 a_15_n100# a_n33_n197# a_n73_n100# w_n211_n319# sky130_fd_pr__pfet_01v8 ad=2.9e+11p pd=2.58e+06u as=2.9e+11p ps=2.58e+06u w=1e+06u l=150000u
C0 a_15_n100# a_n33_n197# 0.03fF
C1 a_n33_n197# w_n211_n319# 0.26fF
C2 a_n73_n100# a_n33_n197# 0.03fF
C3 a_15_n100# w_n211_n319# 0.06fF
C4 a_15_n100# a_n73_n100# 0.16fF
C5 a_n73_n100# w_n211_n319# 0.09fF
C6 a_15_n100# VSUBS 0.02fF
C7 a_n73_n100# VSUBS 0.02fF
C8 a_n33_n197# VSUBS 0.05fF
C9 w_n211_n319# VSUBS 1.07fF
.ends

.subckt function_post VDD A B D C F E Fn Gnd
XXM12 m1_n4122_n2248# F Gnd VSUBS sky130_fd_pr__nfet_01v8_648S5X
XXM1 VDD m1_n6798_n26# XM1/w_n211_n319# A VSUBS sky130_fd_pr__pfet_01v8_XGS3BL
XXM2 m1_n638_22# VDD XM2/w_n211_n319# B VSUBS sky130_fd_pr__pfet_01v8_XGS3BL
XXM3 m1_n6798_n26# m1_n5500_n14# XM3/w_n211_n319# C VSUBS sky130_fd_pr__pfet_01v8_XGS3BL
XXM4 m1_n5500_n14# m1_n638_22# XM4/w_n211_n319# D VSUBS sky130_fd_pr__pfet_01v8_XGS3BL
XXM5 m1_n5500_n14# Fn XM5/w_n211_n319# E VSUBS sky130_fd_pr__pfet_01v8_XGS3BL
XXM6 Fn m1_n5500_n14# XM6/w_n211_n319# F VSUBS sky130_fd_pr__pfet_01v8_XGS3BL
XXM7 Fn A m1_n7132_n2270# VSUBS sky130_fd_pr__nfet_01v8_648S5X
XXM9 Fn E m1_n4122_n2248# VSUBS sky130_fd_pr__nfet_01v8_648S5X
XXM8 m1_n7132_n2270# C Fn VSUBS sky130_fd_pr__nfet_01v8_648S5X
XXM10 m1_n7132_n2270# B Gnd VSUBS sky130_fd_pr__nfet_01v8_648S5X
XXM11 Gnd D m1_n7132_n2270# VSUBS sky130_fd_pr__nfet_01v8_648S5X
C0 XM2/w_n211_n319# B 0.10fF
C1 XM6/w_n211_n319# D 0.00fF
C2 XM4/w_n211_n319# m1_n5500_n14# 0.07fF
C3 VDD C 0.01fF
C4 m1_n5500_n14# XM3/w_n211_n319# 0.08fF
C5 Fn m1_n7132_n2270# 0.10fF
C6 m1_n7132_n2270# F 0.00fF
C7 Fn E 0.29fF
C8 F E 0.01fF
C9 VDD XM5/w_n211_n319# 0.04fF
C10 XM1/w_n211_n319# A 0.12fF
C11 A Fn 0.17fF
C12 VDD m1_n5500_n14# 1.48fF
C13 C m1_n7132_n2270# 0.01fF
C14 C E 0.07fF
C15 XM1/w_n211_n319# m1_n6798_n26# 0.08fF
C16 Fn m1_n6798_n26# 0.00fF
C17 m1_n638_22# B 0.01fF
C18 VDD XM4/w_n211_n319# 0.03fF
C19 C A 0.07fF
C20 VDD XM3/w_n211_n319# 0.04fF
C21 XM5/w_n211_n319# E 0.10fF
C22 XM2/w_n211_n319# D 0.00fF
C23 C m1_n6798_n26# 0.01fF
C24 m1_n5500_n14# E 0.01fF
C25 XM6/w_n211_n319# Fn 0.09fF
C26 XM6/w_n211_n319# F 0.05fF
C27 A m1_n5500_n14# 0.00fF
C28 XM3/w_n211_n319# E 0.00fF
C29 m1_n5500_n14# m1_n6798_n26# 0.00fF
C30 A XM3/w_n211_n319# 0.00fF
C31 XM6/w_n211_n319# XM5/w_n211_n319# 0.01fF
C32 m1_n638_22# D 0.01fF
C33 Gnd m1_n7132_n2270# 0.83fF
C34 D F 0.01fF
C35 XM4/w_n211_n319# B 0.00fF
C36 XM3/w_n211_n319# m1_n6798_n26# 0.07fF
C37 VDD E 0.01fF
C38 XM6/w_n211_n319# m1_n5500_n14# 0.12fF
C39 VDD A 0.03fF
C40 m1_n638_22# XM2/w_n211_n319# 0.07fF
C41 XM6/w_n211_n319# XM4/w_n211_n319# 0.01fF
C42 Gnd B 0.02fF
C43 VDD m1_n6798_n26# 0.06fF
C44 VDD B 0.02fF
C45 m1_n7132_n2270# E 0.00fF
C46 Fn m1_n4122_n2248# 0.04fF
C47 F m1_n4122_n2248# 0.00fF
C48 A m1_n7132_n2270# 0.02fF
C49 m1_n5500_n14# D 0.01fF
C50 VDD XM6/w_n211_n319# 0.04fF
C51 C m1_n4122_n2248# 0.00fF
C52 XM4/w_n211_n319# D 0.10fF
C53 XM1/w_n211_n319# Fn 0.00fF
C54 m1_n7132_n2270# B 0.00fF
C55 m1_n6798_n26# E 0.00fF
C56 Fn F 0.04fF
C57 A m1_n6798_n26# 0.01fF
C58 XM4/w_n211_n319# XM2/w_n211_n319# 0.01fF
C59 XM1/w_n211_n319# C 0.00fF
C60 C Fn 0.20fF
C61 XM6/w_n211_n319# E 0.00fF
C62 Gnd D 0.02fF
C63 VDD D 0.01fF
C64 Fn XM5/w_n211_n319# 0.08fF
C65 XM5/w_n211_n319# F 0.00fF
C66 XM1/w_n211_n319# m1_n5500_n14# 0.00fF
C67 VDD XM2/w_n211_n319# 0.11fF
C68 m1_n638_22# m1_n5500_n14# 0.00fF
C69 m1_n5500_n14# Fn 0.07fF
C70 m1_n5500_n14# F 0.01fF
C71 C XM5/w_n211_n319# 0.00fF
C72 m1_n7132_n2270# D 0.01fF
C73 m1_n638_22# XM4/w_n211_n319# 0.07fF
C74 Gnd m1_n4122_n2248# 0.00fF
C75 XM4/w_n211_n319# F 0.00fF
C76 XM1/w_n211_n319# XM3/w_n211_n319# 0.01fF
C77 XM3/w_n211_n319# Fn 0.01fF
C78 C m1_n5500_n14# 0.01fF
C79 m1_n5500_n14# XM5/w_n211_n319# 0.09fF
C80 C XM3/w_n211_n319# 0.14fF
C81 D B 0.06fF
C82 Gnd F 0.01fF
C83 VDD XM1/w_n211_n319# 0.11fF
C84 VDD m1_n638_22# 0.08fF
C85 VDD Fn 0.08fF
C86 VDD F 0.01fF
C87 m1_n7132_n2270# m1_n4122_n2248# 0.00fF
C88 E m1_n4122_n2248# 0.00fF
C89 XM3/w_n211_n319# XM5/w_n211_n319# 0.01fF
C90 D VSUBS 1.06fF
C91 B VSUBS 1.06fF
C92 F VSUBS 1.13fF
C93 E VSUBS 1.00fF
C94 C VSUBS 0.91fF
C95 A VSUBS 1.12fF
C96 m1_n4122_n2248# VSUBS 0.66fF
C97 m1_n7132_n2270# VSUBS 2.52fF
C98 Fn VSUBS 3.63fF
C99 XM6/w_n211_n319# VSUBS 1.07fF
C100 XM5/w_n211_n319# VSUBS 1.07fF
C101 m1_n638_22# VSUBS -0.27fF
C102 XM4/w_n211_n319# VSUBS 1.07fF
C103 m1_n5500_n14# VSUBS 1.43fF
C104 XM3/w_n211_n319# VSUBS 1.07fF
C105 XM2/w_n211_n319# VSUBS 1.07fF
C106 m1_n6798_n26# VSUBS 0.00fF
C107 VDD VSUBS 0.53fF
C108 XM1/w_n211_n319# VSUBS 1.07fF
C109 Gnd VSUBS 2.79fF
.ends
```
**Post-layout Netlist of testbench function schematic :**

Selectively paste the pre-layout netlist of function testbench into the magic generated inverter spice netlist. The final post-layout netlist (Magic tool) of inverter testbench is shown as following.

```
* NGSPICE file created from function_post.ext - technology: sky130A

.subckt sky130_fd_pr__nfet_01v8_648S5X a_n73_n100# a_n33_n188# a_15_n100# a_n175_n274#
X0 a_15_n100# a_n33_n188# a_n73_n100# a_n175_n274# sky130_fd_pr__nfet_01v8 ad=2.9e+11p pd=2.58e+06u as=2.9e+11p ps=2.58e+06u w=1e+06u l=150000u
C0 a_n73_n100# a_n33_n188# 0.03fF
C1 a_15_n100# a_n73_n100# 0.16fF
C2 a_15_n100# a_n33_n188# 0.03fF
C3 a_15_n100# a_n175_n274# 0.08fF
C4 a_n73_n100# a_n175_n274# 0.11fF
C5 a_n33_n188# a_n175_n274# 0.30fF
.ends

.subckt sky130_fd_pr__pfet_01v8_XGS3BL a_n73_n100# a_15_n100# w_n211_n319# a_n33_n197#
+ VSUBS
X0 a_15_n100# a_n33_n197# a_n73_n100# w_n211_n319# sky130_fd_pr__pfet_01v8 ad=2.9e+11p pd=2.58e+06u as=2.9e+11p ps=2.58e+06u w=1e+06u l=150000u
C0 a_15_n100# a_n33_n197# 0.03fF
C1 a_n33_n197# w_n211_n319# 0.26fF
C2 a_n73_n100# a_n33_n197# 0.03fF
C3 a_15_n100# w_n211_n319# 0.06fF
C4 a_15_n100# a_n73_n100# 0.16fF
C5 a_n73_n100# w_n211_n319# 0.09fF
C6 a_15_n100# VSUBS 0.02fF
C7 a_n73_n100# VSUBS 0.02fF
C8 a_n33_n197# VSUBS 0.05fF
C9 w_n211_n319# VSUBS 1.07fF
.ends

.subckt function_post VDD A B D C F E Fn Gnd
XXM12 m1_n4122_n2248# F Gnd VSUBS sky130_fd_pr__nfet_01v8_648S5X
XXM1 VDD m1_n6798_n26# XM1/w_n211_n319# A VSUBS sky130_fd_pr__pfet_01v8_XGS3BL
XXM2 m1_n638_22# VDD XM2/w_n211_n319# B VSUBS sky130_fd_pr__pfet_01v8_XGS3BL
XXM3 m1_n6798_n26# m1_n5500_n14# XM3/w_n211_n319# C VSUBS sky130_fd_pr__pfet_01v8_XGS3BL
XXM4 m1_n5500_n14# m1_n638_22# XM4/w_n211_n319# D VSUBS sky130_fd_pr__pfet_01v8_XGS3BL
XXM5 m1_n5500_n14# Fn XM5/w_n211_n319# E VSUBS sky130_fd_pr__pfet_01v8_XGS3BL
XXM6 Fn m1_n5500_n14# XM6/w_n211_n319# F VSUBS sky130_fd_pr__pfet_01v8_XGS3BL
XXM7 Fn A m1_n7132_n2270# VSUBS sky130_fd_pr__nfet_01v8_648S5X
XXM9 Fn E m1_n4122_n2248# VSUBS sky130_fd_pr__nfet_01v8_648S5X
XXM8 m1_n7132_n2270# C Fn VSUBS sky130_fd_pr__nfet_01v8_648S5X
XXM10 m1_n7132_n2270# B Gnd VSUBS sky130_fd_pr__nfet_01v8_648S5X
XXM11 Gnd D m1_n7132_n2270# VSUBS sky130_fd_pr__nfet_01v8_648S5X
C0 XM2/w_n211_n319# B 0.10fF
C1 XM6/w_n211_n319# D 0.00fF
C2 XM4/w_n211_n319# m1_n5500_n14# 0.07fF
C3 VDD C 0.01fF
C4 m1_n5500_n14# XM3/w_n211_n319# 0.08fF
C5 Fn m1_n7132_n2270# 0.10fF
C6 m1_n7132_n2270# F 0.00fF
C7 Fn E 0.29fF
C8 F E 0.01fF
C9 VDD XM5/w_n211_n319# 0.04fF
C10 XM1/w_n211_n319# A 0.12fF
C11 A Fn 0.17fF
C12 VDD m1_n5500_n14# 1.48fF
C13 C m1_n7132_n2270# 0.01fF
C14 C E 0.07fF
C15 XM1/w_n211_n319# m1_n6798_n26# 0.08fF
C16 Fn m1_n6798_n26# 0.00fF
C17 m1_n638_22# B 0.01fF
C18 VDD XM4/w_n211_n319# 0.03fF
C19 C A 0.07fF
C20 VDD XM3/w_n211_n319# 0.04fF
C21 XM5/w_n211_n319# E 0.10fF
C22 XM2/w_n211_n319# D 0.00fF
C23 C m1_n6798_n26# 0.01fF
C24 m1_n5500_n14# E 0.01fF
C25 XM6/w_n211_n319# Fn 0.09fF
C26 XM6/w_n211_n319# F 0.05fF
C27 A m1_n5500_n14# 0.00fF
C28 XM3/w_n211_n319# E 0.00fF
C29 m1_n5500_n14# m1_n6798_n26# 0.00fF
C30 A XM3/w_n211_n319# 0.00fF
C31 XM6/w_n211_n319# XM5/w_n211_n319# 0.01fF
C32 m1_n638_22# D 0.01fF
C33 Gnd m1_n7132_n2270# 0.83fF
C34 D F 0.01fF
C35 XM4/w_n211_n319# B 0.00fF
C36 XM3/w_n211_n319# m1_n6798_n26# 0.07fF
C37 VDD E 0.01fF
C38 XM6/w_n211_n319# m1_n5500_n14# 0.12fF
C39 VDD A 0.03fF
C40 m1_n638_22# XM2/w_n211_n319# 0.07fF
C41 XM6/w_n211_n319# XM4/w_n211_n319# 0.01fF
C42 Gnd B 0.02fF
C43 VDD m1_n6798_n26# 0.06fF
C44 VDD B 0.02fF
C45 m1_n7132_n2270# E 0.00fF
C46 Fn m1_n4122_n2248# 0.04fF
C47 F m1_n4122_n2248# 0.00fF
C48 A m1_n7132_n2270# 0.02fF
C49 m1_n5500_n14# D 0.01fF
C50 VDD XM6/w_n211_n319# 0.04fF
C51 C m1_n4122_n2248# 0.00fF
C52 XM4/w_n211_n319# D 0.10fF
C53 XM1/w_n211_n319# Fn 0.00fF
C54 m1_n7132_n2270# B 0.00fF
C55 m1_n6798_n26# E 0.00fF
C56 Fn F 0.04fF
C57 A m1_n6798_n26# 0.01fF
C58 XM4/w_n211_n319# XM2/w_n211_n319# 0.01fF
C59 XM1/w_n211_n319# C 0.00fF
C60 C Fn 0.20fF
C61 XM6/w_n211_n319# E 0.00fF
C62 Gnd D 0.02fF
C63 VDD D 0.01fF
C64 Fn XM5/w_n211_n319# 0.08fF
C65 XM5/w_n211_n319# F 0.00fF
C66 XM1/w_n211_n319# m1_n5500_n14# 0.00fF
C67 VDD XM2/w_n211_n319# 0.11fF
C68 m1_n638_22# m1_n5500_n14# 0.00fF
C69 m1_n5500_n14# Fn 0.07fF
C70 m1_n5500_n14# F 0.01fF
C71 C XM5/w_n211_n319# 0.00fF
C72 m1_n7132_n2270# D 0.01fF
C73 m1_n638_22# XM4/w_n211_n319# 0.07fF
C74 Gnd m1_n4122_n2248# 0.00fF
C75 XM4/w_n211_n319# F 0.00fF
C76 XM1/w_n211_n319# XM3/w_n211_n319# 0.01fF
C77 XM3/w_n211_n319# Fn 0.01fF
C78 C m1_n5500_n14# 0.01fF
C79 m1_n5500_n14# XM5/w_n211_n319# 0.09fF
C80 C XM3/w_n211_n319# 0.14fF
C81 D B 0.06fF
C82 Gnd F 0.01fF
C83 VDD XM1/w_n211_n319# 0.11fF
C84 VDD m1_n638_22# 0.08fF
C85 VDD Fn 0.08fF
C86 VDD F 0.01fF
C87 m1_n7132_n2270# m1_n4122_n2248# 0.00fF
C88 E m1_n4122_n2248# 0.00fF
C89 XM3/w_n211_n319# XM5/w_n211_n319# 0.01fF
C90 D VSUBS 1.06fF
C91 B VSUBS 1.06fF
C92 F VSUBS 1.13fF
C93 E VSUBS 1.00fF
C94 C VSUBS 0.91fF
C95 A VSUBS 1.12fF
C96 m1_n4122_n2248# VSUBS 0.66fF
C97 m1_n7132_n2270# VSUBS 2.52fF
C98 Fn VSUBS 3.63fF
C99 XM6/w_n211_n319# VSUBS 1.07fF
C100 XM5/w_n211_n319# VSUBS 1.07fF
C101 m1_n638_22# VSUBS -0.27fF
C102 XM4/w_n211_n319# VSUBS 1.07fF
C103 m1_n5500_n14# VSUBS 1.43fF
C104 XM3/w_n211_n319# VSUBS 1.07fF
C105 XM2/w_n211_n319# VSUBS 1.07fF
C106 m1_n6798_n26# VSUBS 0.00fF
C107 VDD VSUBS 0.53fF
C108 XM1/w_n211_n319# VSUBS 1.07fF
C109 Gnd VSUBS 2.79fF
.ends


*========Manually added===========

V1 A GND pulse(0 1.8 0.1n 10p 10p 1n 2n)
.save i(v1)
V2 B GND pulse(0 1.8 0.2n 10p 10p 1n 2n)
.save i(v2)
V3 C GND pulse(0 1.8 0.3n 10p 10p 1n 2n)
.save i(v3)
V4 D GND pulse(0 1.8 0.4n 10p 10p 1n 2n)
.save i(v4)
V5 E GND pulse(0 1.8 0.5n 10p 10p 1n 2n)
.save i(v5)
V6 F GND pulse(0 1.8 0.6n 10p 10p 1n 2n)
.save i(v6)
V7 VDD GND 1.8
.save i(v7)
x1 VDD A B D C F E Fn GND function_post
**** begin user architecture code

.tran 10p 4n
.control
run
plot A+3 B+3 C+3 D+3 E+3 F+3 Fn
.save all
.endc
.end

.lib /home/swagatika/open_pdks/sky130/sky130A/libs.tech/ngspice/sky130.lib.spice tt

.save all
.GLOBAL GND
.end
```
Save the final post-layout magic netlist in the xschem directory and open the command window in the same directory. Type ngspice `<post-layout_file-name>.spice` in the command window.

![06](https://user-images.githubusercontent.com/114692581/221768682-030cf317-a907-475a-b8c3-5a3f7e1217c1.PNG)

**NgSpice Plot :**

![07](https://user-images.githubusercontent.com/114692581/221768733-6c5884a3-2a64-4f66-87a1-6192cfbbdab0.PNG)

* **Comparison between Pre-layout and Post-layout testbench of function schematic :**

| Function | Pre-layout | Post-layout |
| -------- | ---------- | ----------- |
| Output [Fn] | ![08](https://user-images.githubusercontent.com/114692581/221770284-c1a8f964-d075-4fe0-a264-633653a3f09c.PNG) | ![09](https://user-images.githubusercontent.com/114692581/221770339-2c628a7a-ed0e-4f5e-81f5-e6ca7175c2d0.PNG) |

# Post-layout characterization of given function using ALIGN tool
Go to ALIGN-public directory,
```
$ mkdir work
$ cd work
```
Running the function pre-layout spice netlist on Sky130pdk,
```
schematic2layout.py ../ALIGN-pdk-sky130/examples/function -p ../pdks/SKY130_PDK/
```
A simple SPICE Netlist for given function is written to generate .lef and .gds files,
```
.subckt function A B C D E F Fn VDD Gnd
XM1 net3 A VDD VDD sky130_fd_pr__pfet_01v8 L=120n W=1050n nf=2
XM2 net1 B VDD VDD sky130_fd_pr__pfet_01v8 L=120n W=1050n nf=2
XM3 net2 C net3 net3 sky130_fd_pr__pfet_01v8 L=120n W=1050n nf=2
XM4 net2 D net1 net1 sky130_fd_pr__pfet_01v8 L=120n W=1050n nf=2
XM5 Fn E net2 net2 sky130_fd_pr__pfet_01v8 L=120n W=1050n nf=2
XM6 Fn F net2 net2 sky130_fd_pr__pfet_01v8 L=120n W=1050n nf=2
XM7 Fn A net4 net4 sky130_fd_pr__nfet_01v8 L=120n W=840n nf=2
XM8 Fn C net4 net4 sky130_fd_pr__nfet_01v8 L=120n W=840n nf=2
XM9 Fn E net5 net5 sky130_fd_pr__nfet_01v8 L=120n W=840n nf=2
XM10 net4 B Gnd Gnd sky130_fd_pr__nfet_01v8 L=120n W=840n nf=2
XM11 net4 D Gnd Gnd sky130_fd_pr__nfet_01v8 L=120n W=840n nf=2
XM12 net5 F Gnd Gnd sky130_fd_pr__nfet_01v8 L=120n W=840n nf=2
.ends function
```

![a1](https://user-images.githubusercontent.com/114692581/221782049-a82de4bd-5332-4d12-85f2-3d1503c99f36.PNG)

![a2](https://user-images.githubusercontent.com/114692581/221782098-7777337b-b995-4524-92a2-253681d111ca.PNG)

## Generated .lef and .gds files of given function in KLayout
* **.gds**
  
  ![a3](https://user-images.githubusercontent.com/114692581/221782163-f689a4cf-44f6-4fbd-ae5a-55f18b6aee41.PNG)
  
* **.lef**
  
  ![a4](https://user-images.githubusercontent.com/114692581/221782206-54ff26e7-4e7b-428f-b9b1-56019209e78e.PNG)

To extract the spice netlist of above post-layout go to MAGIC tool and read the .gds file.
Open magic tool and `go to file --> read GDS --> open the .gds file` and view the layout in magic tool.

![a5_1](https://user-images.githubusercontent.com/114692581/222685009-7bd67da2-848f-4cbc-8b5d-a7eeb2c348fe.PNG)

As we can see DRC=1, check DRC by following command and correct the layout accordingly.
```
drc check
drc why
```
Final layout in magic is,

![a5](https://user-images.githubusercontent.com/114692581/222685616-d183c2d1-69d9-422b-b869-a35a9d9aef69.PNG)

Now, click `i` and go to `Tkcon.tcl` command window. Type the following command to extract the netlist.
```
extract do local
extract all
ext2spice hierarchy on
ext2spice scale off
ext2spice cthresh 0 rthresh 0
ext2spice
```
* Align post layout .spice file is created in magic working directory,
```
* SPICE3 file created from FUNCTION_0.ext - technology: sky130A

.subckt NMOS_S_21929916_X1_Y1_1677566905_1677566908 a_200_252# a_230_483# a_147_483#
X0 a_230_483# a_200_252# a_147_483# a_147_483# sky130_fd_pr__nfet_01v8 ad=2.352e+11p pd=2.24e+06u as=4.452e+11p ps=4.42e+06u w=840000u l=150000u
X1 a_147_483# a_200_252# a_230_483# a_147_483# sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=840000u l=150000u
C0 a_230_483# a_200_252# 0.11fF
C1 a_230_483# a_147_483# 0.74fF
C2 a_200_252# a_147_483# 0.89fF
.ends

.subckt PMOS_S_95864420_X1_Y1_1677566906_1677566908 a_230_462# a_200_252# w_0_0# VSUBS
X0 a_230_462# a_200_252# w_0_0# w_0_0# sky130_fd_pr__pfet_01v8 ad=2.94e+11p pd=2.66e+06u as=5.565e+11p ps=5.26e+06u w=1.05e+06u l=150000u
X1 w_0_0# a_200_252# a_230_462# w_0_0# sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=1.05e+06u l=150000u
C0 a_200_252# w_0_0# 0.77fF
C1 a_200_252# a_230_462# 0.11fF
C2 a_230_462# w_0_0# 0.78fF
C3 a_230_462# VSUBS -0.04fF
C4 a_200_252# VSUBS 0.08fF
C5 w_0_0# VSUBS 2.97fF
.ends

.subckt INV_33643809_0_0_1677566908 m1_312_1400# li_405_571# PMOS_S_95864420_X1_Y1_1677566906_1677566908_0/w_0_0#
+ VSUBS
XNMOS_S_21929916_X1_Y1_1677566905_1677566908_0 li_405_571# m1_312_1400# VSUBS NMOS_S_21929916_X1_Y1_1677566905_1677566908
XPMOS_S_95864420_X1_Y1_1677566906_1677566908_0 m1_312_1400# li_405_571# PMOS_S_95864420_X1_Y1_1677566906_1677566908_0/w_0_0#
+ VSUBS PMOS_S_95864420_X1_Y1_1677566906_1677566908
C0 m1_312_1400# PMOS_S_95864420_X1_Y1_1677566906_1677566908_0/w_0_0# 0.01fF
C1 li_405_571# m1_312_1400# 0.09fF
C2 li_405_571# PMOS_S_95864420_X1_Y1_1677566906_1677566908_0/w_0_0# 0.34fF
C3 m1_312_1400# VSUBS 0.69fF
C4 li_405_571# VSUBS 1.50fF
C5 PMOS_S_95864420_X1_Y1_1677566906_1677566908_0/w_0_0# VSUBS 3.02fF
.ends

.subckt NMOS_S_21929916_X1_Y1_1677566910 a_200_252# a_230_483# a_147_483#
X0 a_230_483# a_200_252# a_147_483# a_147_483# sky130_fd_pr__nfet_01v8 ad=2.352e+11p pd=2.24e+06u as=4.452e+11p ps=4.42e+06u w=840000u l=150000u
X1 a_147_483# a_200_252# a_230_483# a_147_483# sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=840000u l=150000u
C0 a_200_252# a_230_483# 0.11fF
C1 a_230_483# a_147_483# 0.74fF
C2 a_200_252# a_147_483# 0.89fF
.ends

.subckt PMOS_S_95864420_X1_Y1_1677566911 a_230_462# a_200_252# w_0_0# VSUBS
X0 a_230_462# a_200_252# w_0_0# w_0_0# sky130_fd_pr__pfet_01v8 ad=2.94e+11p pd=2.66e+06u as=5.565e+11p ps=5.26e+06u w=1.05e+06u l=150000u
X1 w_0_0# a_200_252# a_230_462# w_0_0# sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=1.05e+06u l=150000u
C0 a_230_462# a_200_252# 0.11fF
C1 w_0_0# a_200_252# 0.77fF
C2 a_230_462# w_0_0# 0.78fF
C3 a_230_462# VSUBS -0.04fF
C4 a_200_252# VSUBS 0.08fF
C5 w_0_0# VSUBS 2.97fF
.ends

.subckt DP_PMOS_65570828_X1_Y1_1677566909 a_372_252# a_230_462# a_200_252# a_402_462#
+ w_0_0# VSUBS
X0 w_0_0# a_372_252# a_402_462# w_0_0# sky130_fd_pr__pfet_01v8 ad=8.505e+11p pd=7.92e+06u as=2.94e+11p ps=2.66e+06u w=1.05e+06u l=150000u
X1 a_230_462# a_200_252# w_0_0# w_0_0# sky130_fd_pr__pfet_01v8 ad=2.94e+11p pd=2.66e+06u as=0p ps=0u w=1.05e+06u l=150000u
X2 w_0_0# a_200_252# a_230_462# w_0_0# sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=1.05e+06u l=150000u
X3 a_402_462# a_372_252# w_0_0# w_0_0# sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=1.05e+06u l=150000u
C0 a_372_252# a_200_252# 0.25fF
C1 a_200_252# a_402_462# 0.01fF
C2 a_372_252# a_402_462# 0.11fF
C3 w_0_0# a_200_252# 0.65fF
C4 a_372_252# w_0_0# 0.66fF
C5 a_230_462# a_200_252# 0.12fF
C6 w_0_0# a_402_462# 0.91fF
C7 a_230_462# a_402_462# 0.06fF
C8 a_230_462# w_0_0# 0.72fF
C9 a_402_462# VSUBS -0.06fF
C10 a_230_462# VSUBS -0.11fF
C11 a_372_252# VSUBS 0.05fF
C12 a_200_252# VSUBS 0.01fF
C13 w_0_0# VSUBS 3.45fF
.ends

.subckt FUNCTION_0
XINV_33643809_0_0_1677566908_0 FN E VDD GND INV_33643809_0_0_1677566908
XNMOS_S_21929916_X1_Y1_1677566910_0 li_2469_571# FN GND NMOS_S_21929916_X1_Y1_1677566910
XNMOS_S_21929916_X1_Y1_1677566910_1 m1_1430_896# FN GND NMOS_S_21929916_X1_Y1_1677566910
XNMOS_S_21929916_X1_Y1_1677566910_2 F GND GND NMOS_S_21929916_X1_Y1_1677566910
XNMOS_S_21929916_X1_Y1_1677566910_3 D GND GND NMOS_S_21929916_X1_Y1_1677566910
XNMOS_S_21929916_X1_Y1_1677566910_4 B GND GND NMOS_S_21929916_X1_Y1_1677566910
XPMOS_S_95864420_X1_Y1_1677566911_0 FN F VDD GND PMOS_S_95864420_X1_Y1_1677566911
XPMOS_S_95864420_X1_Y1_1677566911_1 VDD D VDD GND PMOS_S_95864420_X1_Y1_1677566911
XPMOS_S_95864420_X1_Y1_1677566911_2 VDD li_2469_571# VDD GND PMOS_S_95864420_X1_Y1_1677566911
XDP_PMOS_65570828_X1_Y1_1677566909_0 B VDD m1_1430_896# VDD VDD GND DP_PMOS_65570828_X1_Y1_1677566909
C0 VDD F 0.62fF
C1 m1_1430_896# D 0.15fF
C2 B m1_1430_896# 0.03fF
C3 A FN -0.00fF
C4 VDD D 0.75fF
C5 B VDD 1.08fF
C6 li_2469_571# D 0.05fF
C7 F FN 0.20fF
C8 B li_2469_571# 0.14fF
C9 A F -0.01fF
C10 FN D 0.01fF
C11 A D 0.15fF
C12 B A -0.02fF
C13 F D 0.01fF
C14 B F 0.00fF
C15 VDD C 0.78fF
C16 VDD E 0.06fF
C17 B D 0.00fF
C18 VDD m1_1430_896# 0.10fF
C19 FN C -0.00fF
C20 A C 0.00fF
C21 FN E 0.03fF
C22 m1_1430_896# li_2469_571# 0.00fF
C23 A E 0.00fF
C24 VDD li_2469_571# 0.04fF
C25 m1_1430_896# FN 0.00fF
C26 F E 0.03fF
C27 VDD FN 1.61fF
C28 A VDD 1.01fF
C29 C D 0.01fF
C30 E D 0.01fF
C31 B C 0.13fF
C32 FN li_2469_571# -0.00fF
C33 m1_1430_896# F 0.07fF
C34 C GND 0.19fF **FLOATING
C35 A GND 0.11fF **FLOATING
C36 B GND 1.70fF
C37 D GND 1.93fF
C38 F GND 0.71fF
C39 m1_1430_896# GND 1.45fF
C40 li_2469_571# GND 1.77fF
C41 FN GND 1.59fF
C42 E GND 1.19fF
C43 VDD GND 14.04fF
.ends
```
After exporting '.gds' file generated by Align to magic and extract '.spice' file, manually the `.control` statements are added and the postlayout (generated by ALIGN tool) compared with pre-layout testbench inverter schematic.
```
* SPICE3 file created from FUNCTION_0.ext - technology: sky130A

.subckt NMOS_S_21929916_X1_Y1_1677566905_1677566908 a_200_252# a_230_483# a_147_483#
X0 a_230_483# a_200_252# a_147_483# a_147_483# sky130_fd_pr__nfet_01v8 ad=2.352e+11p pd=2.24e+06u as=4.452e+11p ps=4.42e+06u w=840000u l=150000u
X1 a_147_483# a_200_252# a_230_483# a_147_483# sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=840000u l=150000u
C0 a_230_483# a_200_252# 0.11fF
C1 a_230_483# a_147_483# 0.74fF
C2 a_200_252# a_147_483# 0.89fF
.ends

.subckt PMOS_S_95864420_X1_Y1_1677566906_1677566908 a_230_462# a_200_252# w_0_0# VSUBS
X0 a_230_462# a_200_252# w_0_0# w_0_0# sky130_fd_pr__pfet_01v8 ad=2.94e+11p pd=2.66e+06u as=5.565e+11p ps=5.26e+06u w=1.05e+06u l=150000u
X1 w_0_0# a_200_252# a_230_462# w_0_0# sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=1.05e+06u l=150000u
C0 a_200_252# w_0_0# 0.77fF
C1 a_200_252# a_230_462# 0.11fF
C2 a_230_462# w_0_0# 0.78fF
C3 a_230_462# VSUBS -0.04fF
C4 a_200_252# VSUBS 0.08fF
C5 w_0_0# VSUBS 2.97fF
.ends

.subckt INV_33643809_0_0_1677566908 m1_312_1400# li_405_571# PMOS_S_95864420_X1_Y1_1677566906_1677566908_0/w_0_0#
+ VSUBS
XNMOS_S_21929916_X1_Y1_1677566905_1677566908_0 li_405_571# m1_312_1400# VSUBS NMOS_S_21929916_X1_Y1_1677566905_1677566908
XPMOS_S_95864420_X1_Y1_1677566906_1677566908_0 m1_312_1400# li_405_571# PMOS_S_95864420_X1_Y1_1677566906_1677566908_0/w_0_0#
+ VSUBS PMOS_S_95864420_X1_Y1_1677566906_1677566908
C0 m1_312_1400# PMOS_S_95864420_X1_Y1_1677566906_1677566908_0/w_0_0# 0.01fF
C1 li_405_571# m1_312_1400# 0.09fF
C2 li_405_571# PMOS_S_95864420_X1_Y1_1677566906_1677566908_0/w_0_0# 0.34fF
C3 m1_312_1400# VSUBS 0.69fF
C4 li_405_571# VSUBS 1.50fF
C5 PMOS_S_95864420_X1_Y1_1677566906_1677566908_0/w_0_0# VSUBS 3.02fF
.ends

.subckt NMOS_S_21929916_X1_Y1_1677566910 a_200_252# a_230_483# a_147_483#
X0 a_230_483# a_200_252# a_147_483# a_147_483# sky130_fd_pr__nfet_01v8 ad=2.352e+11p pd=2.24e+06u as=4.452e+11p ps=4.42e+06u w=840000u l=150000u
X1 a_147_483# a_200_252# a_230_483# a_147_483# sky130_fd_pr__nfet_01v8 ad=0p pd=0u as=0p ps=0u w=840000u l=150000u
C0 a_200_252# a_230_483# 0.11fF
C1 a_230_483# a_147_483# 0.74fF
C2 a_200_252# a_147_483# 0.89fF
.ends

.subckt PMOS_S_95864420_X1_Y1_1677566911 a_230_462# a_200_252# w_0_0# VSUBS
X0 a_230_462# a_200_252# w_0_0# w_0_0# sky130_fd_pr__pfet_01v8 ad=2.94e+11p pd=2.66e+06u as=5.565e+11p ps=5.26e+06u w=1.05e+06u l=150000u
X1 w_0_0# a_200_252# a_230_462# w_0_0# sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=1.05e+06u l=150000u
C0 a_230_462# a_200_252# 0.11fF
C1 w_0_0# a_200_252# 0.77fF
C2 a_230_462# w_0_0# 0.78fF
C3 a_230_462# VSUBS -0.04fF
C4 a_200_252# VSUBS 0.08fF
C5 w_0_0# VSUBS 2.97fF
.ends

.subckt DP_PMOS_65570828_X1_Y1_1677566909 a_372_252# a_230_462# a_200_252# a_402_462#
+ w_0_0# VSUBS
X0 w_0_0# a_372_252# a_402_462# w_0_0# sky130_fd_pr__pfet_01v8 ad=8.505e+11p pd=7.92e+06u as=2.94e+11p ps=2.66e+06u w=1.05e+06u l=150000u
X1 a_230_462# a_200_252# w_0_0# w_0_0# sky130_fd_pr__pfet_01v8 ad=2.94e+11p pd=2.66e+06u as=0p ps=0u w=1.05e+06u l=150000u
X2 w_0_0# a_200_252# a_230_462# w_0_0# sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=1.05e+06u l=150000u
X3 a_402_462# a_372_252# w_0_0# w_0_0# sky130_fd_pr__pfet_01v8 ad=0p pd=0u as=0p ps=0u w=1.05e+06u l=150000u
C0 a_372_252# a_200_252# 0.25fF
C1 a_200_252# a_402_462# 0.01fF
C2 a_372_252# a_402_462# 0.11fF
C3 w_0_0# a_200_252# 0.65fF
C4 a_372_252# w_0_0# 0.66fF
C5 a_230_462# a_200_252# 0.12fF
C6 w_0_0# a_402_462# 0.91fF
C7 a_230_462# a_402_462# 0.06fF
C8 a_230_462# w_0_0# 0.72fF
C9 a_402_462# VSUBS -0.06fF
C10 a_230_462# VSUBS -0.11fF
C11 a_372_252# VSUBS 0.05fF
C12 a_200_252# VSUBS 0.01fF
C13 w_0_0# VSUBS 3.45fF
.ends

.subckt FUNCTION_0 VDD A B D C F E Fn Gnd
XINV_33643809_0_0_1677566908_0 FN E VDD GND INV_33643809_0_0_1677566908
XNMOS_S_21929916_X1_Y1_1677566910_0 li_2469_571# FN GND NMOS_S_21929916_X1_Y1_1677566910
XNMOS_S_21929916_X1_Y1_1677566910_1 m1_1430_896# FN GND NMOS_S_21929916_X1_Y1_1677566910
XNMOS_S_21929916_X1_Y1_1677566910_2 F GND GND NMOS_S_21929916_X1_Y1_1677566910
XNMOS_S_21929916_X1_Y1_1677566910_3 D GND GND NMOS_S_21929916_X1_Y1_1677566910
XNMOS_S_21929916_X1_Y1_1677566910_4 B GND GND NMOS_S_21929916_X1_Y1_1677566910
XPMOS_S_95864420_X1_Y1_1677566911_0 FN F VDD GND PMOS_S_95864420_X1_Y1_1677566911
XPMOS_S_95864420_X1_Y1_1677566911_1 VDD D VDD GND PMOS_S_95864420_X1_Y1_1677566911
XPMOS_S_95864420_X1_Y1_1677566911_2 VDD li_2469_571# VDD GND PMOS_S_95864420_X1_Y1_1677566911
XDP_PMOS_65570828_X1_Y1_1677566909_0 B VDD m1_1430_896# VDD VDD GND DP_PMOS_65570828_X1_Y1_1677566909
C0 VDD F 0.62fF
C1 m1_1430_896# D 0.15fF
C2 B m1_1430_896# 0.03fF
C3 A FN -0.00fF
C4 VDD D 0.75fF
C5 B VDD 1.08fF
C6 li_2469_571# D 0.05fF
C7 F FN 0.20fF
C8 B li_2469_571# 0.14fF
C9 A F -0.01fF
C10 FN D 0.01fF
C11 A D 0.15fF
C12 B A -0.02fF
C13 F D 0.01fF
C14 B F 0.00fF
C15 VDD C 0.78fF
C16 VDD E 0.06fF
C17 B D 0.00fF
C18 VDD m1_1430_896# 0.10fF
C19 FN C -0.00fF
C20 A C 0.00fF
C21 FN E 0.03fF
C22 m1_1430_896# li_2469_571# 0.00fF
C23 A E 0.00fF
C24 VDD li_2469_571# 0.04fF
C25 m1_1430_896# FN 0.00fF
C26 F E 0.03fF
C27 VDD FN 1.61fF
C28 A VDD 1.01fF
C29 C D 0.01fF
C30 E D 0.01fF
C31 B C 0.13fF
C32 FN li_2469_571# -0.00fF
C33 m1_1430_896# F 0.07fF
C34 C GND 0.19fF
**FLOATING
C35 A GND 0.11fF
**FLOATING
C36 B GND 1.70fF
C37 D GND 1.93fF
C38 F GND 0.71fF
C39 m1_1430_896# GND 1.45fF
C40 li_2469_571# GND 1.77fF
C41 FN GND 1.59fF
C42 E GND 1.19fF
C43 VDD GND 14.04fF
.ends



*========Manually added===========

V1 A GND pulse(0 1.8 0.1n 10p 10p 1n 2n)
.save i(v1)
V2 B GND pulse(0 1.8 0.2n 10p 10p 1n 2n)
.save i(v2)
V3 C GND pulse(0 1.8 0.3n 10p 10p 1n 2n)
.save i(v3)
V4 D GND pulse(0 1.8 0.4n 10p 10p 1n 2n)
.save i(v4)
V5 E GND pulse(0 1.8 0.5n 10p 10p 1n 2n)
.save i(v5)
V6 F GND pulse(0 1.8 0.6n 10p 10p 1n 2n)
.save i(v6)
V7 VDD GND 1.8
.save i(v7)
x1 VDD A B D C F E Fn GND FUNCTION_0
**** begin user architecture code

.tran 10p 4n
.control
run
plot A+3 B+3 C+3 D+3 E+3 F+3 Fn
.save all
.endc
.end

.lib /home/swagatika/open_pdks/sky130/sky130A/libs.tech/ngspice/sky130.lib.spice tt

.save all
.GLOBAL GND
.end
```
* **NgSpice plot**
  
  ![a6](https://user-images.githubusercontent.com/114692581/222688987-e963025b-56cc-4523-baec-3c7d859e86aa.PNG)
  
  ![a7](https://user-images.githubusercontent.com/114692581/221786410-cbbbb45a-b11b-48fb-812f-4ee6470071d4.PNG)
  
* **Comparison between Pre-layout and Post-layout testbench of function schematic :**

| Function | Pre-layout | Post-layout [MAGIC] | Post-layout [ALIGN] |
| -------- | ---------- | ------------------- | ------------------- |
| Output [Fn] | ![08](https://user-images.githubusercontent.com/114692581/221770284-c1a8f964-d075-4fe0-a264-633653a3f09c.PNG) | ![09](https://user-images.githubusercontent.com/114692581/221770339-2c628a7a-ed0e-4f5e-81f5-e6ca7175c2d0.PNG) | ![a8](https://user-images.githubusercontent.com/114692581/221786903-2a1d000f-0dd4-47ab-a9c4-6aefd50b1c33.PNG) |










    

